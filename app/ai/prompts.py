import json

MUSCLE_GROUPS_COMBINED = [
    "–≥—Ä—É–¥—å –∏ —Ä—É–∫–∏",
    "—Å–ø–∏–Ω–∞ –∏ –ø–ª–µ—á–∏",
    "–ø—Ä–µ—Å—Å –∏ –∫–æ—Ä–ø—É—Å"
]

MUSCLE_GROUPS_SINGLE = [
    "–≥—Ä—É–¥—å",
    "—Å–ø–∏–Ω–∞",
    "–Ω–æ–≥–∏",
    "–ø–ª–µ—á–∏",
    "—Ä—É–∫–∏",
    "–ø—Ä–µ—Å—Å"
]

PRO_MUSCLE_GROUPS_MEN = [
    "–ü–ª–µ—á–∏",
    "–°–ø–∏–Ω–∞",
    "–ì—Ä—É–¥–Ω—ã–µ ‚Äî –≤–µ—Ä—Ö",
    "–ì—Ä—É–¥–Ω—ã–µ ‚Äî —Å–µ—Ä–µ–¥–∏–Ω–∞",
    "–ì—Ä—É–¥–Ω—ã–µ ‚Äî –Ω–∏–∑",
    "–ü—Ä–µ—Å—Å",
    "–†—É–∫–∏ ‚Äî –±–∏—Ü–µ–ø—Å",
    "–†—É–∫–∏ ‚Äî —Ç—Ä–∏—Ü–µ–ø—Å",
    "–ù–æ–≥–∏",
    "–Ø–≥–æ–¥–∏—Ü—ã –∏ –ø–æ—è—Å–Ω–∏—Ü–∞",
    "–ö–∞—Ä–¥–∏–æ",
    "–û–±—â–∏–π –∫–æ–º–ø–ª–µ–∫—Å",
]

PRO_MUSCLE_GROUPS_WOMEN = [
    "–Ø–≥–æ–¥–∏—Ü—ã",
    "–ë—ë–¥—Ä–∞",
    "–ü—Ä–µ—Å—Å –∏ –∫–æ—Å—ã–µ –º—ã—à—Ü—ã –∂–∏–≤–æ—Ç–∞",
    "–ü–ª–µ—á–∏",
    "–°–ø–∏–Ω–∞ (–≤–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å)",
    "–†—É–∫–∏",
    "–ö–∞—Ä–¥–∏–æ",
    "–û–±—â–∏–π –∫–æ–º–ø–ª–µ–∫—Å",
]

PRO_MUSCLE_SETS_MEN = [
    ["–ì—Ä—É–¥–Ω—ã–µ ‚Äî –≤–µ—Ä—Ö", "–†—É–∫–∏ ‚Äî –±–∏—Ü–µ–ø—Å"],
    ["–°–ø–∏–Ω–∞", "–ü–ª–µ—á–∏"],
    ["–ì—Ä—É–¥–Ω—ã–µ ‚Äî –Ω–∏–∑", "–†—É–∫–∏ ‚Äî —Ç—Ä–∏—Ü–µ–ø—Å"],
    ["–ù–æ–≥–∏", "–Ø–≥–æ–¥–∏—Ü—ã –∏ –ø–æ—è—Å–Ω–∏—Ü–∞"],
    ["–ü—Ä–µ—Å—Å", "–ö–∞—Ä–¥–∏–æ"],
    ["–û–±—â–∏–π –∫–æ–º–ø–ª–µ–∫—Å"],
]

PRO_MUSCLE_SETS_WOMEN = [
    ["–Ø–≥–æ–¥–∏—Ü—ã", "–ë—ë–¥—Ä–∞"],
    ["–ü—Ä–µ—Å—Å –∏ –∫–æ—Å—ã–µ –º—ã—à—Ü—ã –∂–∏–≤–æ—Ç–∞", "–ö–∞—Ä–¥–∏–æ"],
    ["–ü–ª–µ—á–∏", "–†—É–∫–∏"],
    ["–°–ø–∏–Ω–∞ (–≤–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å)", "–ü–ª–µ—á–∏"],
    ["–û–±—â–∏–π –∫–æ–º–ø–ª–µ–∫—Å"],
]

WORKOUT_SPLITS = {
    1: ["–æ–±—â–∏–π –∫–æ–º–ø–ª–µ–∫—Å"],
    2: ["–≤–µ—Ä—Ö", "–Ω–∏–∑"],
    3: ["–≥—Ä—É–¥—å", "—Å–ø–∏–Ω–∞", "–Ω–æ–≥–∏"],
    4: ["–≥—Ä—É–¥—å", "—Å–ø–∏–Ω–∞", "–Ω–æ–≥–∏", "–ø–ª–µ—á–∏"],
    5: ["–≥—Ä—É–¥—å", "—Å–ø–∏–Ω–∞", "–Ω–æ–≥–∏", "–ø–ª–µ—á–∏", "—Ä—É–∫–∏"]
}

SPLIT_DESCRIPTIONS = {
    1: "–û–±—â–∏–π –∫–æ–º–ø–ª–µ–∫—Å (1 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –≤ –Ω–µ–¥–µ–ª—é)",
    2: "–í–µ—Ä—Ö/–ù–∏–∑ (2 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –≤ –Ω–µ–¥–µ–ª—é)",
    3: "–ì—Ä—É–¥—å/–°–ø–∏–Ω–∞/–ù–æ–≥–∏ (3 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –≤ –Ω–µ–¥–µ–ª—é)",
    4: "–ì—Ä—É–¥—å/–°–ø–∏–Ω–∞/–ù–æ–≥–∏/–ü–ª–µ—á–∏ (4 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –≤ –Ω–µ–¥–µ–ª—é)",
    5: "–ì—Ä—É–¥—å/–°–ø–∏–Ω–∞/–ù–æ–≥–∏/–ü–ª–µ—á–∏/–†—É–∫–∏ (5+ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –≤ –Ω–µ–¥–µ–ª—é)"
}

TIP_TYPES = [
    "—Ñ–∏—Ç–Ω–µ—Å –∏ —Ç–µ—Ö–Ω–∏–∫–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π",
    "–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–∏—Ç–∞–Ω–∏–∏ –∏ –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏–∏",
    "–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏ —Å–Ω–µ",
    "–º–æ—Ç–∏–≤–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ü–µ–ª–µ–π",
    "–ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–µ —Ç—Ä–∞–≤–º –∏ —Ä–∞–∑–º–∏–Ω–∫–µ"
]

def build_wellbeing_workout_structured_prompt(
    user: dict,
    wellbeing_reason: str,
    avoid_exercise_names: list[str] | None,
    split_info: str,
    superset_info: str,
    workout_history_info: str,
    exercises_info: str,
) -> str:
    # –í–ê–ñ–ù–û: –≤ wellbeing-—Ä–µ–∂–∏–º–µ AI —Å–∞–º –≤—ã–±–∏—Ä–∞–µ—Ç –≥—Ä—É–ø–ø—ã –º—ã—à—Ü, –∏—Å—Ö–æ–¥—è –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è.
    avoid_block = ""
    if avoid_exercise_names:
        safe_list = [x.strip() for x in avoid_exercise_names if isinstance(x, str) and x.strip()]
        if safe_list:
            avoid_block = (
                "\n\n–ò–ó–ë–ï–ì–ê–ô –ü–û–í–¢–û–†–û–í (—ç—Ç–æ –±—ã–ª–æ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ —ç—Ç–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏):\n"
                f"{', '.join(safe_list[:18])}\n"
                "–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –Ω–æ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–º–µ—Ç–Ω–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º–∏ –∏/–∏–ª–∏ –∏—Ö –ø–æ—Ä—è–¥–∫–æ–º.\n"
            )
    return f"""–¢—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–∏—Ç–Ω–µ—Å-—Ç—Ä–µ–Ω–µ—Ä. –°–æ—Å—Ç–∞–≤—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –°–¢–†–û–ì–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON (–±–µ–∑ Markdown, –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω–∏–π).

–ö–û–ù–¢–ï–ö–°–¢ –°–ê–ú–û–ß–£–í–°–¢–í–ò–Ø:
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –ø–æ –ø—Ä–∏—á–∏–Ω–µ: {wellbeing_reason}.
–°–æ—Å—Ç–∞–≤—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É —Å —É—á—ë—Ç–æ–º —ç—Ç–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (–ø–æ—Å–ª–∞–±–ª–µ–Ω–∏—è, –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π, —Å–Ω–∏–∂–µ–Ω–Ω–∞—è –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å).
{avoid_block}

–î–ê–ù–ù–´–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø:
–¶–µ–ª—å: {user.get('goal', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}
–£—Ä–æ–≤–µ–Ω—å: {user.get('level', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}
–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (–∞–Ω–∫–µ—Ç–∞): {user.get('health_issues', '–Ω–µ—Ç')}
–ú–µ—Å—Ç–æ –∑–∞–Ω—è—Ç–∏–π: {user.get('location', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}
–ß–∞—Å—Ç–æ—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ (–∏–∑ –∞–Ω–∫–µ—Ç—ã): {user.get('workouts_per_week', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')} —Ä–∞–∑/–Ω–µ–¥
–í—Ä–µ–º—è –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É: {user.get('workout_duration', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}
–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ: {user.get('equipment', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}
–§–æ—Ä–º–∞—Ç—ã: {user.get('workout_formats', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}
–†–æ—Å—Ç: {user.get('height', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')} —Å–º, –í–µ—Å: {user.get('weight', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')} –∫–≥, –í–æ–∑—Ä–∞—Å—Ç: {user.get('age', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}, –ü–æ–ª: {user.get('gender', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}

{split_info}
{superset_info}
{workout_history_info}
{exercises_info}

–¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö JSON:
–í–µ—Ä–Ω–∏ –æ–±—ä–µ–∫—Ç —Ç–∞–∫–æ–≥–æ –≤–∏–¥–∞:
{{
  "version": 1,
  "title": "–ö–æ—Ä–æ—Ç–∫–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏",
  "muscle_groups": ["–°–ø–∏–Ω–∞", "–ü–ª–µ—á–∏"],
  "exercises": [
    {{"name": "–ù–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è", "weight_kg": 4, "sets": 3, "reps": 12}}
  ],
  "calories_burned": 320
}}

–û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø:
- muscle_groups: 1‚Äì3 –≥—Ä—É–ø–ø—ã –º—ã—à—Ü, –∫–æ—Ç–æ—Ä—ã–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã –∏ —É–º–µ—Å—Ç–Ω—ã –ø—Ä–∏ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤—ã–±–∏—Ä–∞–π —Å–∞–º)
- exercises: 5‚Äì8 —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π
- sets: 2‚Äì6
- reps: –æ–¥–Ω–æ –∏–∑ –∑–Ω–∞—á–µ–Ω–∏–π: 5, 8, 10, 12, 15
- weight_kg: –æ–¥–Ω–æ –∏–∑ –∑–Ω–∞—á–µ–Ω–∏–π: 2, 4, 6, 8, 10, 12, 16, 20, 25, 30, 40, 50 (–µ—Å–ª–∏ –≤–µ—Å –Ω–µ –Ω—É–∂–µ–Ω ‚Äî —Å—Ç–∞–≤—å 0)
- calories_burned: —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ, –æ—Ü–µ–Ω–∫–∞ —Å–æ–∂–∂–µ–Ω–Ω—ã—Ö –∫–∞–ª–æ—Ä–∏–π –∑–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É

–ü–†–ê–í–ò–õ–ê:
- –ù–µ –≤–∫–ª—é—á–∞–π —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —É—Ö—É–¥—à–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —É—Å–∏–ª–∏—Ç—å –±–æ–ª—å –∏–ª–∏ –Ω–∞–≥—Ä—É–∑–∏—Ç—å —Ç—Ä–∞–≤–º–∏—Ä–æ–≤–∞–Ω–Ω—É—é –æ–±–ª–∞—Å—Ç—å
- –ü—Ä–µ–¥–ª–∞–≥–∞–π –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã (–≤–∞—Ä–∏–∞—Ü–∏–∏, –º–µ–Ω—å—à–∞—è –∞–º–ø–ª–∏—Ç—É–¥–∞, –∏–∑–æ–º–µ—Ç—Ä–∏–∫–∞, –º–æ–±–∏–ª–∏—Ç–∏), –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
- –£—á–∏—Ç—ã–≤–∞–π –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –ü–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏–∑–±–µ–≥–∞–π –ø–æ–≤—Ç–æ—Ä–æ–≤ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
- –í–æ–∑–≤—Ä–∞—â–∞–π –¢–û–õ–¨–ö–û JSON (–æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ –∏–ª–∏ –º–Ω–æ–≥–æ —Å—Ç—Ä–æ–∫ ‚Äî –Ω–µ –≤–∞–∂–Ω–æ)"""

def build_manual_workout_infer_prompt(user: dict, exercises: list[dict[str, object]]) -> str:
    # –ù–∞ –≤—Ö–æ–¥–µ exercises: [{"name": "...", "weight_kg": 0|int, "sets": 0|int, "reps": 0|int}, ...]
    # –í–ê–ñ–ù–û: –º—ã –ù–ï –º–µ–Ω—è–µ–º —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è, –∞ —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏.
    return f"""–¢—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–∏—Ç–Ω–µ—Å-—Ç—Ä–µ–Ω–µ—Ä. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –∏ –≤–µ—Ä–Ω–∏ –°–¢–†–û–ì–û JSON (–±–µ–∑ Markdown, –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω–∏–π).

–î–ê–ù–ù–´–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø:
–ü–æ–ª: {user.get('gender', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}
–¶–µ–ª—å: {user.get('goal', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}
–£—Ä–æ–≤–µ–Ω—å: {user.get('level', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}
–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ: {user.get('equipment', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}

–í–´–ü–û–õ–ù–ï–ù–ù–´–ï –£–ü–†–ê–ñ–ù–ï–ù–ò–Ø (–∫–∞–∫ –≤–≤—ë–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å):
{json.dumps(exercises, ensure_ascii=False)}

–¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö JSON:
–í–µ—Ä–Ω–∏ –æ–±—ä–µ–∫—Ç —Ç–∞–∫–æ–≥–æ –≤–∏–¥–∞:
{{
  "title": "–ö–æ—Ä–æ—Ç–∫–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (–¥–æ 60 —Å–∏–º–≤–æ–ª–æ–≤)",
  "muscle_groups": ["–°–ø–∏–Ω–∞", "–ü–ª–µ—á–∏"],
  "calories_burned": 320
}}

–ü–†–ê–í–ò–õ–ê:
- muscle_groups: 1‚Äì3 –≥—Ä—É–ø–ø—ã –º—ã—à—Ü –ø–æ —Å–º—ã—Å–ª—É —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π (–±–µ–∑ –ª–∏—à–Ω–µ–≥–æ)
- calories_burned: —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ, –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞
- –ù–µ –∏–∑–º–µ–Ω—è–π –∏ –Ω–µ –¥–æ–ø–æ–ª–Ω—è–π —Å–ø–∏—Å–æ–∫ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π
- –í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û JSON"""


def build_workout_structured_prompt(
    user: dict,
    muscle_group: str,
    split_info: str,
    superset_info: str,
    workout_history_info: str,
    exercises_info: str,
) -> str:
    def _parse_selected_groups(value: str) -> list[str]:
        parts = [p.strip() for p in value.split(",")]
        return [p for p in parts if p]

    selected_groups = _parse_selected_groups(muscle_group)
    is_multi_group = len(selected_groups) > 1
    selected_groups_text = ", ".join(selected_groups) if selected_groups else muscle_group

    muscle_groups_constraints = (
        f"- muscle_groups: 2‚Äì4 –≥—Ä—É–ø–ø—ã –º—ã—à—Ü (–∏–∑ —Å–ø–∏—Å–∫–∞: {selected_groups_text}), –±–µ–∑ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö"
        if is_multi_group
        else f"- muscle_groups: 1‚Äì2 –≥—Ä—É–ø–ø—ã –º—ã—à—Ü, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –¥–Ω—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏: {selected_groups_text}"
    )

    balance_rule = (
        f"- –°–±–∞–ª–∞–Ω—Å–∏—Ä—É–π —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –º–µ–∂–¥—É –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ –≥—Ä—É–ø–ø–∞–º–∏ –º—ã—à—Ü: {selected_groups_text}"
        if is_multi_group
        else ""
    )

    allowed_rule = (
        f"- –ù–µ –¥–æ–±–∞–≤–ª—è–π —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –Ω–∞ –¥—Ä—É–≥–∏–µ –≥—Ä—É–ø–ø—ã –º—ã—à—Ü, –∫—Ä–æ–º–µ: {selected_groups_text}"
        if is_multi_group
        else f"- –ù–µ –¥–æ–±–∞–≤–ª—è–π —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –Ω–∞ –¥—Ä—É–≥–∏–µ –≥—Ä—É–ø–ø—ã –º—ã—à—Ü, –∫—Ä–æ–º–µ {selected_groups_text}"
    )

    # –í–ê–ñ–ù–û: –§—Ä–æ–Ω—Ç –æ–∂–∏–¥–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É 1-–≤-1 –ø–æ–¥ UI (–º—ã—à—Ü—ã + —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è —Å –≤–µ—Å/–ø–æ–¥—Ö–æ–¥—ã/–ø–æ–≤—Ç–æ—Ä—ã).
    # –ü—Ä–æ—Å–∏–º AI –≤–µ—Ä–Ω—É—Ç—å —Ç–æ–ª—å–∫–æ JSON, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –º—É—Å–æ—Ä–∞ –≤–æ–∫—Ä—É–≥.
    return f"""–¢—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–∏—Ç–Ω–µ—Å-—Ç—Ä–µ–Ω–µ—Ä. –°–æ—Å—Ç–∞–≤—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –°–¢–†–û–ì–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON (–±–µ–∑ Markdown, –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω–∏–π).

–î–ê–ù–ù–´–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø:
–¶–µ–ª—å: {user.get('goal', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}
–£—Ä–æ–≤–µ–Ω—å: {user.get('level', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}
–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: {user.get('health_issues', '–Ω–µ—Ç')}
–ú–µ—Å—Ç–æ –∑–∞–Ω—è—Ç–∏–π: {user.get('location', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}
–ß–∞—Å—Ç–æ—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ (–∏–∑ –∞–Ω–∫–µ—Ç—ã): {user.get('workouts_per_week', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')} —Ä–∞–∑/–Ω–µ–¥
–í—Ä–µ–º—è –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É: {user.get('workout_duration', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}
–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ: {user.get('equipment', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}
–§–æ—Ä–º–∞—Ç—ã: {user.get('workout_formats', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}
–†–æ—Å—Ç: {user.get('height', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')} —Å–º, –í–µ—Å: {user.get('weight', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')} –∫–≥, –í–æ–∑—Ä–∞—Å—Ç: {user.get('age', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}, –ü–æ–ª: {user.get('gender', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}

{split_info}
{superset_info}
{workout_history_info}
{exercises_info}

–¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö JSON:
–í–µ—Ä–Ω–∏ –æ–±—ä–µ–∫—Ç —Ç–∞–∫–æ–≥–æ –≤–∏–¥–∞:
{{
  "version": 1,
  "title": "–ö–æ—Ä–æ—Ç–∫–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏",
  "muscle_groups": ["–°–ø–∏–Ω–∞", "–ü–ª–µ—á–∏"],
  "exercises": [
    {{"name": "–ù–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è", "weight_kg": 4, "sets": 3, "reps": 12}}
  ],
  "calories_burned": 320
}}

–û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø:
{muscle_groups_constraints}
- exercises: 5‚Äì8 —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π
- sets: 2‚Äì6
- reps: –æ–¥–Ω–æ –∏–∑ –∑–Ω–∞—á–µ–Ω–∏–π: 5, 8, 10, 12, 15
- weight_kg: –æ–¥–Ω–æ –∏–∑ –∑–Ω–∞—á–µ–Ω–∏–π: 2, 4, 6, 8, 10, 12, 16, 20, 25, 30, 40, 50 (–µ—Å–ª–∏ –≤–µ—Å –Ω–µ –Ω—É–∂–µ–Ω ‚Äî —Å—Ç–∞–≤—å 0)
- calories_burned: —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ, –æ—Ü–µ–Ω–∫–∞ —Å–æ–∂–∂–µ–Ω–Ω—ã—Ö –∫–∞–ª–æ—Ä–∏–π –∑–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É

–ü–†–ê–í–ò–õ–ê:
{allowed_rule}
{balance_rule}
- –£—á–∏—Ç—ã–≤–∞–π –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –ò–∑–±–µ–≥–∞–π –ø–æ–≤—Ç–æ—Ä–æ–≤ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫, –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ
- –í–æ–∑–≤—Ä–∞—â–∞–π –¢–û–õ–¨–ö–û JSON (–æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ –∏–ª–∏ –º–Ω–æ–≥–æ —Å—Ç—Ä–æ–∫ ‚Äî –Ω–µ –≤–∞–∂–Ω–æ)"""


def build_workout_single_exercise_prompt(
    user: dict,
    muscle_group: str,
    superset_info: str,
    workout_history_info: str,
    existing_exercise_names: list[str],
) -> str:
    existing = ", ".join(existing_exercise_names[:12])
    return f"""–¢—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–∏—Ç–Ω–µ—Å-—Ç—Ä–µ–Ω–µ—Ä. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –û–î–ù–û —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –°–¢–†–û–ì–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON (–±–µ–∑ Markdown, –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω–∏–π).

–î–ê–ù–ù–´–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø:
–¶–µ–ª—å: {user.get('goal', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}
–£—Ä–æ–≤–µ–Ω—å: {user.get('level', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}
–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: {user.get('health_issues', '–Ω–µ—Ç')}
–ú–µ—Å—Ç–æ –∑–∞–Ω—è—Ç–∏–π: {user.get('location', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}
–í—Ä–µ–º—è –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É: {user.get('workout_duration', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}
–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ: {user.get('equipment', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}
–§–æ—Ä–º–∞—Ç—ã: {user.get('workout_formats', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}

–°–µ–≥–æ–¥–Ω—è —Ç—Ä–µ–Ω–∏—Ä—É–µ–º: {muscle_group}.
{superset_info}
{workout_history_info}

–£–ñ–ï –ï–°–¢–¨ –í –¢–†–ï–ù–ò–†–û–í–ö–ï (–∏–∑–±–µ–≥–∞–π –ø–æ–≤—Ç–æ—Ä–æ–≤ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é): {existing}

–§–û–†–ú–ê–¢ JSON:
{{
  "name": "–ù–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è",
  "weight_kg": 4,
  "sets": 3,
  "reps": 12
}}

–û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø:
- –¢–û–õ–¨–ö–û –Ω–∞ –≥—Ä—É–ø–ø—ã –º—ã—à—Ü: {muscle_group}
- sets: 2‚Äì6
- reps: –æ–¥–Ω–æ –∏–∑ –∑–Ω–∞—á–µ–Ω–∏–π: 5, 8, 10, 12, 15
- weight_kg: –æ–¥–Ω–æ –∏–∑ –∑–Ω–∞—á–µ–Ω–∏–π: 2, 4, 6, 8, 10, 12, 16, 20, 25, 30, 40, 50 (–µ—Å–ª–∏ –≤–µ—Å –Ω–µ –Ω—É–∂–µ–Ω ‚Äî —Å—Ç–∞–≤—å 0)

–ü–†–ê–í–ò–õ–ê:
- –£—á–∏—Ç—ã–≤–∞–π –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –í–æ–∑–≤—Ä–∞—â–∞–π –¢–û–õ–¨–ö–û JSON"""

def build_workout_prompt(
    user: dict,
    muscle_group: str,
    exercise_count: int,
    tip_type: str,
    split_info: str,
    superset_info: str,
    workout_history_info: str,
    exercises_info: str
) -> str:
    return f"""–¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–∏—Ç–Ω–µ—Å—Å-—Ç—Ä–µ–Ω–µ—Ä. –°–µ–≥–æ–¥–Ω—è —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–µ–Ω—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏: {muscle_group}. 
–°–æ—Å—Ç–∞–≤—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–π –≥—Ä—É–ø–ø—ã –º—ã—à—Ü, –Ω–µ –¥–æ–±–∞–≤–ª—è–π —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –Ω–∞ –¥—Ä—É–≥–∏–µ –≥—Ä—É–ø–ø—ã. 
–£—á–∏—Ç—ã–≤–∞–π —Ü–µ–ª—å, —É—Ä–æ–≤–µ–Ω—å, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, —á–∞—Å—Ç–æ—Ç—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫, –≤—Ä–µ–º—è –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É, –¥–æ—Å—Ç—É–ø–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ, –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã, —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –º–µ—Å—Ç–æ –∑–∞–Ω—è—Ç–∏–π.

–¶–µ–ª—å: {user.get('goal', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}. 
–£—Ä–æ–≤–µ–Ω—å: {user.get('level', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}. 
–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: {user.get('health_issues', '–Ω–µ—Ç')}. 
–ú–µ—Å—Ç–æ –∑–∞–Ω—è—Ç–∏–π: {user.get('location', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}. 
–ß–∞—Å—Ç–æ—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ (–∏–∑ –∞–Ω–∫–µ—Ç—ã): {user.get('workouts_per_week', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')} —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é. 
–í—Ä–µ–º—è –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É: {user.get('workout_duration', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}. 
–î–æ—Å—Ç—É–ø–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ: {user.get('equipment', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}. 
–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫: {user.get('workout_formats', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}. 
–†–æ—Å—Ç: {user.get('height', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')} —Å–º. –í–µ—Å: {user.get('weight', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')} –∫–≥. –í–æ–∑—Ä–∞—Å—Ç: {user.get('age', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}. –ü–æ–ª: {user.get('gender', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}. 

{split_info}
{superset_info}
{workout_history_info}
{exercises_info}

–í–ê–ñ–ù–´–ï –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø:
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ: {user.get('equipment', '—Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–µ—Å')}
‚Ä¢ –ü—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–π—Å—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏: {user.get('workout_formats', '–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Å–∏–ª–æ–≤–∞—è')}
‚Ä¢ –£–ª–æ–∂–∏—Å—å –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è: {user.get('workout_duration', '30-45 –º–∏–Ω—É—Ç')}
‚Ä¢ –ü–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏–∑–±–µ–≥–∞–π –ø–æ–≤—Ç–æ—Ä–æ–≤ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –∏–∑ —Å–ø–∏—Å–∫–∞ –≤—ã—à–µ, –Ω–æ –µ—Å–ª–∏ –±–∞–∑–æ–≤–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–∏, –º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ —Å –≤–∞—Ä–∏–∞—Ü–∏–µ–π

–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π —Ä–æ–≤–Ω–æ {exercise_count} —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π (–ø–æ—Å–ª–µ–¥–Ω–µ–µ ‚Äî –∫–∞—Ä–¥–∏–æ –∏–ª–∏ –∑–∞–º–∏–Ω–∫–∞). –°–¥–µ–ª–∞–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–π –≤–Ω—É—Ç—Ä–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≥—Ä—É–ø–ø—ã –º—ã—à—Ü.
–î–ª—è –∫–∞–∂–¥–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑—ã–≤–∞–π –≤–µ—Å (–¥–∞–∂–µ –µ—Å–ª–∏ —ç—Ç–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–µ—Å ‚Äî –ø–∏—à–∏ —è–≤–Ω–æ).

–§–æ—Ä–º–∞—Ç–∏—Ä—É–π –æ—Ç–≤–µ—Ç —Å—Ç—Ä–æ–≥–æ —Ç–∞–∫:
–°–æ–≤–µ—Ç –¥–Ω—è: [–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–æ–≤–µ—Ç –æ {tip_type}, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ —Ü–µ–ª—å ({user.get('goal', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}), —É—Ä–æ–≤–µ–Ω—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ ({user.get('level', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')}) –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –°–æ–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–º –∏ –ø—Ä–∏–º–µ–Ω–∏–º—ã–º]

–ü–ª–∞–Ω —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è: {muscle_group}

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π —Ç–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç:
[–ù–æ–º–µ—Ä]. [–ù–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è]
[–∫–æ–ª-–≤–æ –ø–æ–¥—Ö–æ–¥–æ–≤ √ó –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π ‚Äî –≤–µ—Å]
*–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø–æ —Ç–µ—Ö–Ω–∏–∫–µ –∏–ª–∏ —Å–æ–≤–µ—Ç*

–ü–æ—Å–ª–µ–¥–Ω–µ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –≤—Å–µ–≥–¥–∞ –∫–∞—Ä–¥–∏–æ –∏–ª–∏ –∑–∞–º–∏–Ω–∫–∞, —É–∫–∞–∑—ã–≤–∞–π –µ–≥–æ –≤ —Ç–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ.

–ù–µ –¥–æ–±–∞–≤–ª—è–π –ª–∏—à–Ω–∏—Ö –ø–æ—è—Å–Ω–µ–Ω–∏–π –≤–Ω–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–ª–∞–Ω–∞."""


FOOD_ANALYSIS_PROMPT = """–û–ø—Ä–µ–¥–µ–ª–∏, —á—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–æ –Ω–∞ —Ñ–æ—Ç–æ, –∏ –æ—Ü–µ–Ω–∏ –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç—å –±–ª—é–¥–∞. 
–í–µ—Ä–Ω–∏ JSON –≤–∏–¥–∞: {"description": "...", "calories": ..., "proteins": ..., "fats": ..., "carbs": ...}. 
–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∂–∏ –ë–ñ–£ (–±–µ–ª–∫–∏, –∂–∏—Ä—ã, —É–≥–ª–µ–≤–æ–¥—ã) –≤ –≥—Ä–∞–º–º–∞—Ö. 
–û—Ç–≤–µ—á–∞–π –≤—Å–µ–≥–¥–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ."""


FOOD_CLARIFICATION_PROMPT = """–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏—Å–ª–∞–ª —Ñ–æ—Ç–æ –µ–¥—ã. –í–æ—Ç –µ–≥–æ —É—Ç–æ—á–Ω–µ–Ω–∏–µ: '{clarification}'. 
–û–ø—Ä–µ–¥–µ–ª–∏, —á—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–æ –Ω–∞ —Ñ–æ—Ç–æ, –∏ –æ—Ü–µ–Ω–∏ –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç—å –±–ª—é–¥–∞ —Å —É—á—ë—Ç–æ–º —É—Ç–æ—á–Ω–µ–Ω–∏—è. 
–í–µ—Ä–Ω–∏ JSON –≤–∏–¥–∞: {{"description": "...", "calories": ..., "proteins": ..., "fats": ..., "carbs": ...}}. 
–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∂–∏ –ë–ñ–£ (–±–µ–ª–∫–∏, –∂–∏—Ä—ã, —É–≥–ª–µ–≤–æ–¥—ã) –≤ –≥—Ä–∞–º–º–∞—Ö. 
–û—Ç–≤–µ—á–∞–π –≤—Å–µ–≥–¥–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ."""


DAILY_MENU_SYSTEM_PROMPT = "–¢—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –¥–∏–µ—Ç–æ–ª–æ–≥. –°–æ–∑–¥–∞—ë—à—å —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ —Ä–∞—Ü–∏–æ–Ω—ã –Ω–∞ –¥–µ–Ω—å. –í–æ–∑–≤—Ä–∞—â–∞–π —Ç–æ–ª—å–∫–æ JSON."

DAILY_MENU_SYSTEM_PROMPT_LEGACY = "–¢—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –¥–∏–µ—Ç–æ–ª–æ–≥. –°–æ–∑–¥–∞—ë—à—å —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ —Ä–∞—Ü–∏–æ–Ω—ã –Ω–∞ –¥–µ–Ω—å. –û—Ç–≤–µ—á–∞–π –≤—Å–µ–≥–¥–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ."

SHOPPING_LIST_SYSTEM_PROMPT = "–¢—ã –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—é —Å–ø–∏—Å–∫–æ–≤ –ø—Ä–æ–¥—É–∫—Ç–æ–≤. –û—Ç–≤–µ—á–∞–π –≤—Å–µ–≥–¥–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ."


def build_daily_menu_structured_prompt(user: dict, nutrition_plan: dict, day_name: str = "") -> str:
	"""Build prompt for structured JSON menu generation for a single day."""
	user_info = f"""
–§–∏–∑–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ:
- –ü–æ–ª: {user.get('gender', '–Ω–µ —É–∫–∞–∑–∞–Ω')}
- –í–æ–∑—Ä–∞—Å—Ç: {user.get('age', '–Ω–µ —É–∫–∞–∑–∞–Ω')}
- –†–æ—Å—Ç: {user.get('height', '–Ω–µ —É–∫–∞–∑–∞–Ω')} —Å–º
- –í–µ—Å: {user.get('weight', '–Ω–µ —É–∫–∞–∑–∞–Ω')} –∫–≥
- –¶–µ–ª—å —Ñ–∏—Ç–Ω–µ—Å–∞: {user.get('goal', '–Ω–µ —É–∫–∞–∑–∞–Ω–∞')}
- –£—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏: {user.get('level', '–Ω–µ —É–∫–∞–∑–∞–Ω')}
- –ß–∞—Å—Ç–æ—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫: {user.get('workouts_per_week', '–Ω–µ —É–∫–∞–∑–∞–Ω–∞')} —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–ª–∞–Ω–∞ –ø–∏—Ç–∞–Ω–∏—è:
- –¶–µ–ª—å –ø–∏—Ç–∞–Ω–∏—è: {nutrition_plan.get('nutrition_goal', '')}
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: {nutrition_plan.get('dietary_restrictions', '')}
- –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è: {nutrition_plan.get('meal_preferences', '')}
- –í—Ä–µ–º—è –Ω–∞ –≥–æ—Ç–æ–≤–∫—É: {nutrition_plan.get('cooking_time', '')}
- –ë—é–¥–∂–µ—Ç: {nutrition_plan.get('budget', '')}
""".strip()

	target_calories = nutrition_plan.get('target_calories', 2000)
	target_proteins = nutrition_plan.get('target_proteins', 100)
	target_fats = nutrition_plan.get('target_fats', 70)
	target_carbs = nutrition_plan.get('target_carbs', 250)
	
	day_context = f"–≠—Ç–æ —Ä–∞—Ü–∏–æ–Ω –Ω–∞ {day_name}. " if day_name else ""

	return f"""
–°–æ–∑–¥–∞–π —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–π —Ä–∞—Ü–∏–æ–Ω –Ω–∞ –¥–µ–Ω—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. {day_context}

{user_info}

–¶–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –Ω–∞ –¥–µ–Ω—å:
- –ö–∞–ª–æ—Ä–∏–∏: {target_calories} –∫–∫–∞–ª
- –ë–µ–ª–∫–∏: {target_proteins} –≥
- –ñ–∏—Ä—ã: {target_fats} –≥
- –£–≥–ª–µ–≤–æ–¥—ã: {target_carbs} –≥

–í–µ—Ä–Ω–∏ JSON —Å—Ç—Ä–æ–≥–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ:
{{
  "target_calories": {target_calories},
  "target_proteins": {target_proteins},
  "target_fats": {target_fats},
  "target_carbs": {target_carbs},
  "sections": [
    {{
      "type": "breakfast",
      "title": "–ó–∞–≤—Ç—Ä–∞–∫",
      "time_range": "7:00-9:00",
      "items": [
        {{"name": "–ù–∞–∑–≤–∞–Ω–∏–µ –±–ª—é–¥–∞", "calories": 350, "proteins": 15, "fats": 10, "carbs": 45}}
      ]
    }},
    {{
      "type": "lunch",
      "title": "–û–±–µ–¥",
      "time_range": "12:00-14:00",
      "items": [
        {{"name": "–ù–∞–∑–≤–∞–Ω–∏–µ –±–ª—é–¥–∞", "calories": 500, "proteins": 30, "fats": 15, "carbs": 60}}
      ]
    }},
    {{
      "type": "dinner",
      "title": "–£–∂–∏–Ω",
      "time_range": "18:00-20:00",
      "items": [
        {{"name": "–ù–∞–∑–≤–∞–Ω–∏–µ –±–ª—é–¥–∞", "calories": 400, "proteins": 25, "fats": 12, "carbs": 40}}
      ]
    }},
    {{
      "type": "snacks",
      "title": "–ü–µ—Ä–µ–∫—É—Å—ã",
      "time_range": "–í —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è",
      "items": [
        {{"name": "–ù–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–∫—É—Å–∞", "calories": 150, "proteins": 5, "fats": 3, "carbs": 20}}
      ]
    }}
  ],
  "tip_of_day": "–ü—Ä–∞–∫—Ç–∏—á–Ω—ã–π —Å–æ–≤–µ—Ç –ø–æ –ø–∏—Ç–∞–Ω–∏—é"
}}

–í–ê–ñ–ù–û:
1. –°–æ–∑–¥–∞–π –£–ù–ò–ö–ê–õ–¨–ù–´–ï –±–ª—é–¥–∞ –¥–ª—è —ç—Ç–æ–≥–æ –¥–Ω—è
2. –£—á–∏—Ç—ã–≤–∞–π –≤—Å–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –ü–æ–¥–±–µ—Ä–∏ –±–ª—é–¥–∞ –ø–æ–¥ –±—é–¥–∂–µ—Ç –∏ –≤—Ä–µ–º—è –≥–æ—Ç–æ–≤–∫–∏
4. –°—É–º–º–∞ –∫–∞–ª–æ—Ä–∏–π –≤—Å–µ—Ö –±–ª—é–¥ –¥–æ–ª–∂–Ω–∞ –ø—Ä–∏–±–ª–∏–∂–∞—Ç—å—Å—è –∫ —Ü–µ–ª–µ–≤–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é
5. –ë–ª—é–¥–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º–∏ –∏ –≤—ã–ø–æ–ª–Ω–∏–º—ã–º–∏
6. –í –∫–∞–∂–¥–æ–π —Å–µ–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 1-3 –±–ª—é–¥–∞
7. –ù–∞–∑–≤–∞–Ω–∏—è –±–ª—é–¥ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
8. –í–æ–∑–≤—Ä–∞—â–∞–π –¢–û–õ–¨–ö–û JSON, –±–µ–∑ markdown –∏ –ø–æ—è—Å–Ω–µ–Ω–∏–π
""".strip()


def build_weekly_menu_structured_prompt(user: dict, nutrition_plan: dict) -> str:
	"""Build prompt for structured JSON menu generation for 7 days."""
	user_info = f"""
–§–∏–∑–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ:
- –ü–æ–ª: {user.get('gender', '–Ω–µ —É–∫–∞–∑–∞–Ω')}
- –í–æ–∑—Ä–∞—Å—Ç: {user.get('age', '–Ω–µ —É–∫–∞–∑–∞–Ω')}
- –†–æ—Å—Ç: {user.get('height', '–Ω–µ —É–∫–∞–∑–∞–Ω')} —Å–º
- –í–µ—Å: {user.get('weight', '–Ω–µ —É–∫–∞–∑–∞–Ω')} –∫–≥
- –¶–µ–ª—å —Ñ–∏—Ç–Ω–µ—Å–∞: {user.get('goal', '–Ω–µ —É–∫–∞–∑–∞–Ω–∞')}
- –£—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏: {user.get('level', '–Ω–µ —É–∫–∞–∑–∞–Ω')}
- –ß–∞—Å—Ç–æ—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫: {user.get('workouts_per_week', '–Ω–µ —É–∫–∞–∑–∞–Ω–∞')} —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–ª–∞–Ω–∞ –ø–∏—Ç–∞–Ω–∏—è:
- –¶–µ–ª—å –ø–∏—Ç–∞–Ω–∏—è: {nutrition_plan.get('nutrition_goal', '')}
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: {nutrition_plan.get('dietary_restrictions', '')}
- –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è: {nutrition_plan.get('meal_preferences', '')}
- –í—Ä–µ–º—è –Ω–∞ –≥–æ—Ç–æ–≤–∫—É: {nutrition_plan.get('cooking_time', '')}
- –ë—é–¥–∂–µ—Ç: {nutrition_plan.get('budget', '')}
""".strip()

	target_calories = nutrition_plan.get('target_calories', 2000)
	target_proteins = nutrition_plan.get('target_proteins', 100)
	target_fats = nutrition_plan.get('target_fats', 70)
	target_carbs = nutrition_plan.get('target_carbs', 250)

	return f"""
–°–æ–∑–¥–∞–π —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–µ –º–µ–Ω—é –Ω–∞ –ù–ï–î–ï–õ–Æ (7 –¥–Ω–µ–π) –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

{user_info}

–¶–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ù–ê –ö–ê–ñ–î–´–ô –î–ï–ù–¨:
- –ö–∞–ª–æ—Ä–∏–∏: {target_calories} –∫–∫–∞–ª
- –ë–µ–ª–∫–∏: {target_proteins} –≥
- –ñ–∏—Ä—ã: {target_fats} –≥
- –£–≥–ª–µ–≤–æ–¥—ã: {target_carbs} –≥

–í–µ—Ä–Ω–∏ JSON –º–∞—Å—Å–∏–≤ –∏–∑ 7 –æ–±—ä–µ–∫—Ç–æ–≤ (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫-–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ):
[
  {{
    "day_of_week": 0,
    "day_name": "–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫",
    "sections": [
      {{
        "type": "breakfast",
        "title": "–ó–∞–≤—Ç—Ä–∞–∫",
        "time_range": "7:00-9:00",
        "items": [{{"name": "–ë–ª—é–¥–æ", "calories": 350, "proteins": 15, "fats": 10, "carbs": 45}}]
      }},
      {{
        "type": "lunch",
        "title": "–û–±–µ–¥",
        "time_range": "12:00-14:00",
        "items": [{{"name": "–ë–ª—é–¥–æ", "calories": 500, "proteins": 30, "fats": 15, "carbs": 60}}]
      }},
      {{
        "type": "dinner",
        "title": "–£–∂–∏–Ω",
        "time_range": "18:00-20:00",
        "items": [{{"name": "–ë–ª—é–¥–æ", "calories": 400, "proteins": 25, "fats": 12, "carbs": 40}}]
      }},
      {{
        "type": "snacks",
        "title": "–ü–µ—Ä–µ–∫—É—Å—ã",
        "time_range": "–í —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è",
        "items": [{{"name": "–ü–µ—Ä–µ–∫—É—Å", "calories": 150, "proteins": 5, "fats": 3, "carbs": 20}}]
      }}
    ],
    "tip_of_day": "–°–æ–≤–µ—Ç –¥–Ω—è"
  }},
  ... // –µ—â–µ 6 –¥–Ω–µ–π (–≤—Ç–æ—Ä–Ω–∏–∫=1, —Å—Ä–µ–¥–∞=2, —á–µ—Ç–≤–µ—Ä–≥=3, –ø—è—Ç–Ω–∏—Ü–∞=4, —Å—É–±–±–æ—Ç–∞=5, –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ=6)
]

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û - –¢–û–ß–ù–û–ï –°–û–û–¢–í–ï–¢–°–¢–í–ò–ï –ö–ë–ñ–£:
1. –°—É–º–º–∞ –∫–∞–ª–æ—Ä–∏–π –≤—Å–µ—Ö –±–ª—é–¥ –∑–∞ –¥–µ–Ω—å –î–û–õ–ñ–ù–ê –¢–û–ß–ù–û —Ä–∞–≤–Ω—è—Ç—å—Å—è {target_calories} –∫–∫–∞–ª (¬±50 –∫–∫–∞–ª)
2. –°—É–º–º–∞ –±–µ–ª–∫–æ–≤ –î–û–õ–ñ–ù–ê –¢–û–ß–ù–û —Ä–∞–≤–Ω—è—Ç—å—Å—è {target_proteins} –≥ (¬±5 –≥)
3. –°—É–º–º–∞ –∂–∏—Ä–æ–≤ –î–û–õ–ñ–ù–ê –¢–û–ß–ù–û —Ä–∞–≤–Ω—è—Ç—å—Å—è {target_fats} –≥ (¬±5 –≥)
4. –°—É–º–º–∞ —É–≥–ª–µ–≤–æ–¥–æ–≤ –î–û–õ–ñ–ù–ê –¢–û–ß–ù–û —Ä–∞–≤–Ω—è—Ç—å—Å—è {target_carbs} –≥ (¬±10 –≥)
5. –†–∞—Å—Å—á–∏—Ç–∞–π –ö–ë–ñ–£ –∫–∞–∂–¥–æ–≥–æ –±–ª—é–¥–∞ —Ç–∞–∫, —á—Ç–æ–±—ã –ø—Ä–∏ —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø–æ–ª—É—á–∏–ª–∏—Å—å —Ü–µ–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

–î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø:
6. –°–æ–∑–¥–∞–π –£–ù–ò–ö–ê–õ–¨–ù–´–ï –±–ª—é–¥–∞ –Ω–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å - –ù–ï –ø–æ–≤—Ç–æ—Ä—è–π –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –±–ª—é–¥–∞
7. –£—á–∏—Ç—ã–≤–∞–π –≤—Å–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
8. –ü–æ–¥–±–µ—Ä–∏ –±–ª—é–¥–∞ –ø–æ–¥ –±—é–¥–∂–µ—Ç –∏ –≤—Ä–µ–º—è –≥–æ—Ç–æ–≤–∫–∏
9. –í –∫–∞–∂–¥–æ–π —Å–µ–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 1-3 –±–ª—é–¥–∞
10. –ù–∞–∑–≤–∞–Ω–∏—è –±–ª—é–¥ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
11. –í–æ–∑–≤—Ä–∞—â–∞–π –¢–û–õ–¨–ö–û JSON –º–∞—Å—Å–∏–≤, –±–µ–∑ markdown –∏ –ø–æ—è—Å–Ω–µ–Ω–∏–π

–ü–†–û–í–ï–†–ö–ê: –ü–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º —É–±–µ–¥–∏—Å—å, —á—Ç–æ —Å—É–º–º–∞ calories/proteins/fats/carbs –∑–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ü–µ–ª–µ–≤—ã–º!
8. day_of_week: 0=–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 1=–≤—Ç–æ—Ä–Ω–∏–∫, ..., 6=–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
""".strip()


def build_daily_menu_prompt(user: dict, nutrition_plan: dict) -> str:
	"""Legacy prompt for text-based menu generation."""
	user_info = f"""
–§–∏–∑–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ:
- –ü–æ–ª: {user.get('gender', '–Ω–µ —É–∫–∞–∑–∞–Ω')}
- –í–æ–∑—Ä–∞—Å—Ç: {user.get('age', '–Ω–µ —É–∫–∞–∑–∞–Ω')}
- –†–æ—Å—Ç: {user.get('height', '–Ω–µ —É–∫–∞–∑–∞–Ω')} —Å–º
- –í–µ—Å: {user.get('weight', '–Ω–µ —É–∫–∞–∑–∞–Ω')} –∫–≥
- –¶–µ–ª—å —Ñ–∏—Ç–Ω–µ—Å–∞: {user.get('goal', '–Ω–µ —É–∫–∞–∑–∞–Ω–∞')}
- –£—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏: {user.get('level', '–Ω–µ —É–∫–∞–∑–∞–Ω')}
- –ß–∞—Å—Ç–æ—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫: {user.get('workouts_per_week', '–Ω–µ —É–∫–∞–∑–∞–Ω–∞')} —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–ª–∞–Ω–∞ –ø–∏—Ç–∞–Ω–∏—è:
- –¶–µ–ª—å –ø–∏—Ç–∞–Ω–∏—è: {nutrition_plan.get('nutrition_goal', '')}
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: {nutrition_plan.get('dietary_restrictions', '')}
- –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è: {nutrition_plan.get('meal_preferences', '')}
- –í—Ä–µ–º—è –Ω–∞ –≥–æ—Ç–æ–≤–∫—É: {nutrition_plan.get('cooking_time', '')}
- –ë—é–¥–∂–µ—Ç: {nutrition_plan.get('budget', '')}
""".strip()

	target_kbju = ""
	if nutrition_plan.get("target_calories"):
		target_kbju = f"""
–¶–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
- –ö–∞–ª–æ—Ä–∏–∏: {nutrition_plan.get('target_calories')} –∫–∫–∞–ª
- –ë–µ–ª–∫–∏: {nutrition_plan.get('target_proteins', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')} –≥
- –ñ–∏—Ä—ã: {nutrition_plan.get('target_fats', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')} –≥
- –£–≥–ª–µ–≤–æ–¥—ã: {nutrition_plan.get('target_carbs', '–Ω–µ —É–∫–∞–∑–∞–Ω–æ')} –≥
""".strip()

	return f"""
–°–æ–∑–¥–∞–π –ù–û–í–´–ô —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–π —Ä–∞—Ü–∏–æ–Ω –Ω–∞ –¥–µ–Ω—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

{user_info}
{target_kbju}

–°–æ–∑–¥–∞–π —Ä–∞—Ü–∏–æ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ:

üìä **–¶–ï–õ–ï–í–´–ï –ü–û–ö–ê–ó–ê–¢–ï–õ–ò –ù–ê –î–ï–ù–¨:**
–ö–∞–ª–æ—Ä–∏–∏: {nutrition_plan.get('target_calories', '—Ä–∞—Å—Å—á–∏—Ç–∞–π')} –∫–∫–∞–ª
–ë–µ–ª–∫–∏: {nutrition_plan.get('target_proteins', '—Ä–∞—Å—Å—á–∏—Ç–∞–π')} –≥
–ñ–∏—Ä—ã: {nutrition_plan.get('target_fats', '—Ä–∞—Å—Å—á–∏—Ç–∞–π')} –≥
–£–≥–ª–µ–≤–æ–¥—ã: {nutrition_plan.get('target_carbs', '—Ä–∞—Å—Å—á–∏—Ç–∞–π')} –≥

ü•ó **–†–ê–¶–ò–û–ù –ù–ê –°–ï–ì–û–î–ù–Ø:**

**–ó–ê–í–¢–†–ê–ö (7:00-9:00):**
‚Ä¢ [–ë–ª—é–¥–æ 1] - [–∫–∞–ª–æ—Ä–∏–∏] –∫–∫–∞–ª, –ë[–±–µ–ª–∫–∏]–≥/–ñ[–∂–∏—Ä—ã]–≥/–£[—É–≥–ª–µ–≤–æ–¥—ã]–≥
‚Ä¢ [–ë–ª—é–¥–æ 2] - [–∫–∞–ª–æ—Ä–∏–∏] –∫–∫–∞–ª, –ë[–±–µ–ª–∫–∏]–≥/–ñ[–∂–∏—Ä—ã]–≥/–£[—É–≥–ª–µ–≤–æ–¥—ã]–≥

**–û–ë–ï–î (12:00-14:00):**
‚Ä¢ [–ë–ª—é–¥–æ 1] - [–∫–∞–ª–æ—Ä–∏–∏] –∫–∫–∞–ª, –ë[–±–µ–ª–∫–∏]–≥/–ñ[–∂–∏—Ä—ã]–≥/–£[—É–≥–ª–µ–≤–æ–¥—ã]–≥
‚Ä¢ [–ë–ª—é–¥–æ 2] - [–∫–∞–ª–æ—Ä–∏–∏] –∫–∫–∞–ª, –ë[–±–µ–ª–∫–∏]–≥/–ñ[–∂–∏—Ä—ã]–≥/–£[—É–≥–ª–µ–≤–æ–¥—ã]–≥

**–£–ñ–ò–ù (18:00-20:00):**
‚Ä¢ [–ë–ª—é–¥–æ 1] - [–∫–∞–ª–æ—Ä–∏–∏] –∫–∫–∞–ª, –ë[–±–µ–ª–∫–∏]–≥/–ñ[–∂–∏—Ä—ã]–≥/–£[—É–≥–ª–µ–≤–æ–¥—ã]–≥
‚Ä¢ [–ë–ª—é–¥–æ 2] - [–∫–∞–ª–æ—Ä–∏–∏] –∫–∫–∞–ª, –ë[–±–µ–ª–∫–∏]–≥/–ñ[–∂–∏—Ä—ã]–≥/–£[—É–≥–ª–µ–≤–æ–¥—ã]–≥

**–ü–ï–†–ï–ö–£–°–´:**
‚Ä¢ [–ü–µ—Ä–µ–∫—É—Å 1] - [–∫–∞–ª–æ—Ä–∏–∏] –∫–∫–∞–ª
‚Ä¢ [–ü–µ—Ä–µ–∫—É—Å 2] - [–∫–∞–ª–æ—Ä–∏–∏] –∫–∫–∞–ª

üí° **–°–û–í–ï–¢ –î–ù–Ø:**
[–ü—Ä–∞–∫—Ç–∏—á–Ω—ã–π —Å–æ–≤–µ—Ç –ø–æ –ø–∏—Ç–∞–Ω–∏—é –∏–ª–∏ –≥–æ—Ç–æ–≤–∫–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è]

–í–ê–ñ–ù–û:
1. –ö–∞–∂–¥—ã–π —Ä–∞–∑ —Å–æ–∑–¥–∞–≤–∞–π –†–ê–ó–ù–´–ï –±–ª—é–¥–∞ –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
2. –£—á–∏—Ç—ã–≤–∞–π –≤—Å–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è
3. –ü–æ–¥–±–µ—Ä–∏ –±–ª—é–¥–∞ –ø–æ–¥ –±—é–¥–∂–µ—Ç –∏ –≤—Ä–µ–º—è –≥–æ—Ç–æ–≤–∫–∏
4. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∂–∏ –ö–ë–ñ–£ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–ª—é–¥–∞
5. –ë–ª—é–¥–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º–∏ –∏ –≤—ã–ø–æ–ª–Ω–∏–º—ã–º–∏
""".strip()


def build_shopping_list_prompt(daily_menu: str) -> str:
	return f"""
–ù–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞—Ü–∏–æ–Ω–∞ —Å–æ–∑–¥–∞–π —É–¥–æ–±–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –¥–ª—è –ø–æ–∫—É–ø–∫–∏:

{daily_menu}

–°–æ–∑–¥–∞–π —Å–ø–∏—Å–æ–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:

üõí **–°–ü–ò–°–û–ö –ü–†–û–î–£–ö–¢–û–í:**

**–ú–Ø–°–û –ò –†–´–ë–ê:**
‚Ä¢ [–ü—Ä–æ–¥—É–∫—Ç] - [–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ]
‚Ä¢ [–ü—Ä–æ–¥—É–∫—Ç] - [–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ]

**–ú–û–õ–û–ß–ù–´–ï –ü–†–û–î–£–ö–¢–´:**
‚Ä¢ [–ü—Ä–æ–¥—É–∫—Ç] - [–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ]
‚Ä¢ [–ü—Ä–æ–¥—É–∫—Ç] - [–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ]

**–û–í–û–©–ò –ò –§–†–£–ö–¢–´:**
‚Ä¢ [–ü—Ä–æ–¥—É–∫—Ç] - [–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ]
‚Ä¢ [–ü—Ä–æ–¥—É–∫—Ç] - [–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ]

**–ö–†–£–ü–´ –ò –ú–ê–ö–ê–†–û–ù–´:**
‚Ä¢ [–ü—Ä–æ–¥—É–∫—Ç] - [–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ]

**–î–†–£–ì–û–ï:**
‚Ä¢ [–ü—Ä–æ–¥—É–∫—Ç] - [–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ]

üí∞ **–ü–†–ò–ú–ï–†–ù–ê–Ø –°–¢–û–ò–ú–û–°–¢–¨:** [—Å—É–º–º–∞] ‚ÇΩ

–¢–†–ï–ë–û–í–ê–ù–ò–Ø:
1. –£–∫–∞–∑—ã–≤–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ (–≥—Ä–∞–º–º—ã, —à—Ç—É–∫–∏, –ø–∞—á–∫–∏)
2. –ì—Ä—É–ø–ø–∏—Ä—É–π –ø—Ä–æ–¥—É–∫—Ç—ã –ø–æ –æ—Ç–¥–µ–ª–∞–º –º–∞–≥–∞–∑–∏–Ω–∞
3. –£—á–∏—Ç—ã–≤–∞–π —á—Ç–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å –¥–æ–º–∞
4. –î–æ–±–∞–≤—å –ø—Ä–∏–º–µ—Ä–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–∫—É–ø–∫–∏
5. –¢–æ–ª—å–∫–æ –ø—Ä–æ–¥—É–∫—Ç—ã –∏–∑ —Ä–∞—Ü–∏–æ–Ω–∞ –≤—ã—à–µ
""".strip()

